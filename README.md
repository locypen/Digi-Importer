# Digikala Product Importer

پلاگین حرفه‌ای برای وارد کردن محصولات از دیجی‌کالا به فروشگاه ووکامرس

## 📋 ویژگی‌های کلیدی

- **وارد کردن آسان محصولات**: فقط با وارد کردن لینک محصول دیجی‌کالا
- **پیش‌نمایش کامل**: مشاهده تمام اطلاعات محصول قبل از وارد کردن
- **تنظیمات قابل تنظیم**: امکان تنظیم گارانتی، سیاست بازگشت و سایر اطلاعات
- **مدیریت تصاویر**: وارد کردن خودکار تصاویر با کیفیت مناسب
- **ویژگی‌های محصول**: استخراج و نمایش مشخصات فنی محصولات
- **همگام‌سازی خودکار**: به‌روزرسانی قیمت‌ها به صورت خودکار
- **رابط کاربری فارسی**: طراحی شده مخصوص کاربران فارسی‌زبان

## 🔧 پیش‌نیازها

- WordPress 5.0 یا بالاتر
- WooCommerce 5.0 یا بالاتر
- PHP 7.4 یا بالاتر
- حداقل 256MB حافظه PHP
- دسترسی به cURL

## 📦 نصب

### نصب دستی

1. فایل‌های پلاگین را در پوشه `/wp-content/plugins/digikala-product-importer/` قرار دهید
2. وارد پنل مدیریت وردپرس شوید
3. به قسمت **افزونه‌ها** بروید
4. پلاگین **Digikala Product Importer** را فعال کنید

### ساختار فایل‌ها

```
digikala-product-importer/
├── digikala-product-importer.php
├── includes/
│   ├── admin-page.php
│   └── settings-page.php  
├── assets/
│   ├── css/
│   │   └── admin.css
│   └── js/
│       └── admin.js
├── languages/
│   ├── digikala-importer-fa_IR.po
│   └── digikala-importer-fa_IR.mo
└── README.md
```

## 🚀 نحوه استفاده

### مرحله 1: دسترسی به پلاگین

بعد از فعال‌سازی، از منوی کناری **دیجی‌کالا** را انتخاب کنید.

### مرحله 2: وارد کردن محصول

1. لینک محصول دیجی‌کالا را در فیلد مربوطه وارد کنید
   ```
   مثال: https://www.digikala.com/product/dkp-1234567/
   ```

2. روی **پیش‌نمایش محصول** کلیک کنید

3. اطلاعات محصول را بررسی کنید:
   - نام و توضیحات محصول
   - قیمت اصلی و قیمت فروش
   - تصاویر محصول
   - مشخصات فنی
   - برند و دسته‌بندی

### مرحله 3: تنظیمات سفارشی

در بخش **تنظیمات سفارشی** می‌توانید:

- **گارانتی محصول** را انتخاب یا وارد کنید
- **سیاست بازگشت کالا** را تعیین کنید
- **کلاس ارسال** را انتخاب کنید
- **وضعیت مالیاتی** را تنظیم کنید
- **وضعیت انتشار** محصول را مشخص کنید

### مرحله 4: وارد کردن نهایی

روی **وارد کردن محصول** کلیک کنید. محصول در فروشگاه ووکامرس ایجاد می‌شود.

## ⚙️ تنظیمات پیشرفته

### تب عمومی

- **گارانتی پیش‌فرض**: گارانتی‌ای که برای همه محصولات اعمال می‌شود
- **سیاست بازگشت پیش‌فرض**: متن پیش‌فرض برای بازگشت کالا
- **انتشار خودکار**: محصولات به صورت خودکار منتشر شوند یا پیش‌نویس باشند

### تب محصولات

- **دسته‌بندی پیش‌فرض**: دسته‌بندی محصولات بدون دسته مشخص
- **وضعیت مالیاتی پیش‌فرض**: تنظیم مالیات برای محصولات
- **تبدیل واحد پول**: تبدیل ریال به تومان با نرخ قابل تنظیم

### تب تصاویر

- **حداکثر تعداد تصاویر**: تعداد تصاویری که وارد می‌شود (1-20)
- **کیفیت تصاویر**: درصد کیفیت فشرده‌سازی (10-100%)

### تب همگام‌سازی

- **همگام‌سازی خودکار**: به‌روزرسانی خودکار قیمت‌ها
- **بازه همگام‌سازی**: فاصله زمانی به‌روزرسانی (ساعتی، روزانه، هفتگی)
- **همگام‌سازی دستی**: به‌روزرسانی فوری همه محصولات

### تب پیشرفته

- **مدت زمان کش API**: مدت ذخیره نتایج API در کش
- **ثبت گزارش‌ها**: ذخیره جزئیات عملیات برای رفع اشکال
- **حذف گزارش‌های قدیمی**: حذف خودکار گزارش‌های قدیمی

## 🎯 نمونه‌های کاربرد

### وارد کردن یک گوشی هوشمند

```
لینک: https://www.digikala.com/product/dkp-1234567/samsung-galaxy-s21/

نتیجه:
- نام: Samsung Galaxy S21
- قیمت: 25,000,000 تومان
- دسته‌بندی: گوشی هوشمند
- برند: Samsung
- ویژگی‌ها: 128GB حافظه، 8GB رم، دوربین 64MP
- تصاویر: 5 تصویر با کیفیت
```

### تنظیمات برای فروشگاه لوازم خانگی

```php
// تنظیمات پیشنهادی
گارانتی پیش‌فرض: "18 ماه گارانتی شرکتی"
سیاست بازگشت: "امکان بازگشت کالا تا 7 روز با حفظ شرایط اولیه"
تبدیل ریال به تومان: فعال (نرخ 0.1)
حداکثر تصاویر: 8
کیفیت تصاویر: 85%
```

## 🔧 عیب‌یابی

### مشکلات رایج

**1. خطای "لینک محصول معتبر نیست"**
- بررسی کنید لینک از دیجی‌کالا باشد
- مطمئن شوید لینک شامل `dkp-` و شماره محصول است

**2. خطای "خطا در دریافت اطلاعات محصول"**
- اتصال اینترنت سرور را بررسی کنید
- ممکن است API دیجی‌کالا موقتاً در دسترس نباشد
- کش را پاک کنید

**3. تصاویر وارد نمی‌شوند**
- مجوزهای نوشتن پوشه uploads را بررسی کنید
- حداکثر اندازه فایل PHP را افزایش دهید
- فایروال سرور ممکن است دانلود تصاویر را مسدود کند

### بررسی سیستم

در **تنظیمات > تب پیشرفته** اطلاعات سیستم را مشاهده کنید:

```
نسخه پلاگین: 1.0.0
نسخه وردپرس: 6.3
نسخه ووکامرس: 8.0
نسخه PHP: 8.1
حافظه PHP: 512M
حداکثر زمان اجرا: 300 ثانیه
```

### گزارش‌های خطا

برای فعال‌سازی گزارش‌های تفصیلی، کد زیر را به فایل `wp-config.php` اضافه کنید:

```php
define('WP_DEBUG', true);
define('WP_DEBUG_LOG', true);
define('WP_DEBUG_DISPLAY', false);
```

گزارش‌های خطا در فایل `/wp-content/debug.log` ذخیره می‌شوند.

## 🔒 امنیت

### نکات امنیتی مهم

- تمام ورودی‌های کاربر sanitize می‌شوند
- از WordPress nonce برای محافظت در برابر CSRF استفاده می‌شود
- دسترسی‌ها بر اساس قابلیت‌های کاربر کنترل می‌شوند
- داده‌های حساس در دیتابیس رمزنگاری می‌شوند

### مجوزهای مورد نیاز

- `manage_woocommerce`: برای مدیریت محصولات
- `upload_files`: برای آپلود تصاویر
- `edit_products`: برای ویرایش محصولات

## 📊 بهینه‌سازی عملکرد

### تنظیمات توصیه شده

```php
// در wp-config.php
define('WP_MEMORY_LIMIT', '512M');
ini_set('max_execution_time', 300);
ini_set('max_input_vars', 3000);
```

### کش و بهینه‌سازی

- **کش API**: نتایج API تا 1 ساعت کش می‌شوند
- **کش تصاویر**: تصاویر دانلود شده محلی ذخیره می‌شوند
- **پردازش پس‌زمینه**: عملیات سنگین در پس‌زمینه انجام می‌شوند

### محدودیت‌های نرخ

- حداکثر 60 درخواست در دقیقه به API دیجی‌کالا
- فاصله 1 ثانیه بین درخواست‌های متوالی
- استفاده از retry logic برای درخواست‌های ناموفق

## 🌐 چندزبانگی

پلاگین از زبان‌های زیر پشتیبانی می‌کند:

- **فارسی** (پیش‌فرض)
- **انگلیسی**

### اضافه کردن زبان جدید

1. فایل `.pot` را از پوشه `languages` کپی کنید
2. با ابزار مناسب ترجمه کنید
3. فایل‌های `.po` و `.mo` را در پوشه languages قرار دهید

## 🔄 به‌روزرسانی

### به‌روزرسانی خودکار

پلاگین از سیستم به‌روزرسانی خودکار وردپرس پشتیبانی می‌کند.

### به‌روزرسانی دستی

1. فایل‌های جدید را در پوشه پلاگین کپی کنید
2. پلاگین را غیرفعال و مجدداً فعال کنید
3. تنظیمات را بررسی کنید

### مهاجرت داده‌ها

هنگام به‌روزرسانی، تمام داده‌های موجود حفظ می‌شوند:

- تنظیمات پلاگین
- تاریخچه محصولات وارد شده
- گزارش‌های عملیات
- کش‌های API

## 🛠️ توسعه و سفارشی‌سازی

### هوک‌های موجود

```php
// قبل از وارد کردن محصول
do_action('digikala_importer_before_import', $product_data, $settings);

// بعد از وارد کردن محصول
do_action('digikala_importer_after_import', $product_id, $product_data);

// تغییر داده‌های محصول
$product_data = apply_filters('digikala_importer_product_data', $product_data);

// تغییر تنظیمات پیش‌فرض
$settings = apply_filters('digikala_importer_default_settings', $settings);
```

### نمونه سفارشی‌سازی

```php
// اضافه کردن فیلد سفارشی
add_action('digikala_importer_after_import', function($product_id, $data) {
    update_post_meta($product_id, '_digikala_id', $data['id']);
    update_post_meta($product_id, '_import_date', current_time('mysql'));
});

// تغییر نام محصول
add_filter('digikala_importer_product_data', function($data) {
    $data['title'] = 'فروشگاه ما: ' . $data['title'];
    return $data;
});
```

## 📈 آمار و گزارش‌گیری

### داشبورد آماری

پلاگین آمار کاملی از عملیات ارائه می‌دهد:

- تعداد محصولات وارد شده
- آخرین محصولات وارد شده
- وضعیت همگام‌سازی
- خطاهای رخ داده

### صدور گزارش

امکان صدور گزارش به فرمت‌های:
- CSV
- PDF
- Excel

## 🔧 API و اتصالات خارجی

### API دیجی‌کالا

پلاگین از API غیررسمی دیجی‌کالا استفاده می‌کند:

```
Endpoint: https://api.digikala.com/v2/product/{product_id}/
Method: GET
Rate Limit: 60 requests/minute
```

### Webhook‌ها

امکان تنظیم webhook برای اطلاع از رویدادها:

```php
// تنظیم webhook
add_action('init', function() {
    if (isset($_GET['digikala_webhook'])) {
        // پردازش webhook
        do_action('digikala_webhook_received', $_POST);
    }
});
```

## 🐛 گزارش باگ و درخواست ویژگی

### گزارش مشکلات

برای گزارش مشکلات لطفاً اطلاعات زیر را ارائه دهید:

1. نسخه پلاگین
2. نسخه وردپرس و ووکامرس
3. لینک محصول که مشکل دارد
4. پیام خطای دقیق
5. اسکرین‌شات (در صورت امکان)

### درخواست ویژگی جدید

ویژگی‌های در نظر گرفته شده برای نسخه‌های آینده:

- [ ] پشتیبانی از محصولات متغیر
- [ ] وارد کردن گروهی محصولات
- [ ] اتصال به سایر فروشگاه‌های آنلاین
- [ ] ربات تلگرام برای اطلاع‌رسانی
- [ ] مقایسه قیمت با رقبا
- [ ] تحلیل ترندهای قیمت

## 📄 مجوز

این پلاگین تحت مجوز GPL v2 یا بالاتر منتشر شده است.

```
Copyright (C) 2024

This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 2 of the License, or
(at your option) any later version.
```

## 🤝 مشارکت

برای مشارکت در توسعه پلاگین:

1. مخزن پروژه را fork کنید
2. branch جدید برای ویژگی خود ایجاد کنید
3. تغییرات را commit کنید
4. Pull Request ارسال کنید

### راهنمای کدنویسی

- از WordPress Coding Standards استفاده کنید
- کامنت‌های کافی در کد بنویسید
- تست‌های واحد اضافه کنید
- مستندات را به‌روزرسانی کنید

## 📞 پشتیبانی

### راه‌های ارتباطی

- **ایمیل**: support@yourwebsite.com
- **تلگرام**: @your_telegram
- **وب‌سایت**: https://yourwebsite.com

### ساعات پشتیبانی

- شنبه تا چهارشنبه: 9:00 تا 17:00
- پنج‌شنبه: 9:00 تا 13:00
- جمعه: تعطیل

### سطوح پشتیبانی

1. **رایگان**: راهنمایی کلی و رفع مشکلات ساده
2. **پریمیوم**: پشتیبانی تلفنی و سفارشی‌سازی
3. **سازمانی**: نصب و راه‌اندازی تخصصی

## 📋 چک‌لیست نصب

- [ ] WordPress 5.0+ نصب شده
- [ ] WooCommerce 5.0+ فعال است
- [ ] PHP 7.4+ در دسترس است
- [ ] حافظه PHP حداقل 256MB
- [ ] دسترسی cURL فعال است
- [ ] مجوزهای نوشتن پوشه uploads
- [ ] SSL certificate نصب شده (توصیه می‌شود)

## 🎯 نسخه‌های آینده

### نسخه 1.1 (در حال توسعه)

- پشتیبانی از محصولات متغیر
- بهبود عملکرد و سرعت
- رابط کاربری موبایل

### نسخه 1.2 (برنامه‌ریزی شده)

- وارد کردن گروهی
- مقایسه قیمت‌ها
- گزارش‌گیری پیشرفته

### نسخه 2.0 (آینده دور)

- پشتیبانی از چند فروشگاه
- هوش مصنوعی برای بهینه‌سازی
- اپلیکیشن موبایل

---

**نکته**: این پلاگین برای استفاده شخصی و تجاری در کسب‌وکارهای کوچک و متوسط طراحی شده است. برای استفاده در مقیاس بزرگ لطفاً با تیم پشتیبانی تماس بگیرید.

**هشدار**: لطفاً قوانین و مقررات دیجی‌کالا را رعایت کنید و از این پلاگین به نحوی استفاده کنید که موجب نقض حقوق مالکیت معنوی نشود.
